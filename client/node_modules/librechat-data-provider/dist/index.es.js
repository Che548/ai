import{z as e}from"zod";import t from"axios";var n,o,r,i=function(){return i=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},i.apply(this,arguments)};function a(e,t,n,o){return new(n||(n=Promise))((function(r,i){function a(e){try{l(o.next(e))}catch(e){i(e)}}function s(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((o=o.apply(e,t||[])).next())}))}function s(e,t){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(a=0)),a;)try{if(n=1,o&&(r=2&s[0]?o.return:s[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,s[1])).done)return r;switch(o=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,o=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){a.label=s[1];break}if(6===s[0]&&a.label<r[1]){a.label=r[1],r=s;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(s);break}r[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],o=0}finally{n=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}}"function"==typeof SuppressedError&&SuppressedError,function(e){e.azureOpenAI="azureOpenAI",e.openAI="openAI",e.bingAI="bingAI",e.chatGPTBrowser="chatGPTBrowser",e.google="google",e.gptPlugins="gptPlugins",e.anthropic="anthropic",e.assistant="assistant",e.custom="custom"}(r||(r={}));var l,u=((n={})[r.google]={model:{default:"chat-bison"},maxOutputTokens:{min:1,max:2048,step:1,default:1024,maxGeminiPro:8192,defaultGeminiPro:8192},temperature:{min:0,max:1,step:.01,default:.2},topP:{min:0,max:1,step:.01,default:.8},topK:{min:1,max:40,step:.01,default:40}},n),p=u[r.google],c=e.nativeEnum(r),d=e.union([c,e.string()]);!function(e){e.low="low",e.auto="auto",e.high="high"}(l||(l={}));var h=((o={})[l.low]=0,o[l.auto]=1,o[l.high]=2,o),g={0:l.low,1:l.auto,2:l.high},f=e.nativeEnum(l),m=e.object({authField:e.string(),label:e.string(),description:e.string()}),v=e.object({name:e.string(),pluginKey:e.string(),description:e.string(),icon:e.string(),authConfig:e.array(m),authenticated:e.boolean().optional(),isButton:e.boolean().optional()}),b=e.object({input:e.object({content:e.string()}),output:e.object({content:e.string()})}),y=e.object({agent:e.string(),skipCompletion:e.boolean(),model:e.string(),temperature:e.number()}),I=e.object({messageId:e.string(),endpoint:e.string().optional(),clientId:e.string().nullable().optional(),conversationId:e.string().nullable(),parentMessageId:e.string().nullable(),responseMessageId:e.string().nullable().optional(),overrideParentMessageId:e.string().nullable().optional(),bg:e.string().nullable().optional(),model:e.string().nullable().optional(),title:e.string().nullable().or(e.literal("New Chat")).default("New Chat"),sender:e.string(),text:e.string(),generation:e.string().nullable().optional(),isEdited:e.boolean().optional(),isCreatedByUser:e.boolean(),error:e.boolean(),createdAt:e.string().optional().default((function(){return(new Date).toISOString()})),updatedAt:e.string().optional().default((function(){return(new Date).toISOString()})),current:e.boolean().optional(),unfinished:e.boolean().optional(),searchResult:e.boolean().optional(),finish_reason:e.string().optional()}),P=e.object({conversationId:e.string().nullable(),title:e.string().nullable().or(e.literal("New Chat")).default("New Chat"),user:e.string().optional(),endpoint:c.nullable(),endpointType:c.optional(),suggestions:e.array(e.string()).optional(),messages:e.array(e.string()).optional(),tools:e.array(v).optional(),createdAt:e.string(),updatedAt:e.string(),systemMessage:e.string().nullable().optional(),modelLabel:e.string().nullable().optional(),examples:e.array(b).optional(),chatGptLabel:e.string().nullable().optional(),userLabel:e.string().optional(),model:e.string().nullable().optional(),promptPrefix:e.string().nullable().optional(),temperature:e.number().optional(),topP:e.number().optional(),topK:e.number().optional(),context:e.string().nullable().optional(),top_p:e.number().optional(),frequency_penalty:e.number().optional(),presence_penalty:e.number().optional(),jailbreak:e.boolean().optional(),jailbreakConversationId:e.string().nullable().optional(),conversationSignature:e.string().nullable().optional(),parentMessageId:e.string().optional(),clientId:e.string().nullable().optional(),invocationId:e.number().nullable().optional(),toneStyle:e.string().nullable().optional(),maxOutputTokens:e.number().optional(),agentOptions:y.nullable().optional(),resendImages:e.boolean().optional(),imageDetail:f.optional(),assistant_id:e.string().optional(),thread_id:e.string().optional()}),O=P.omit({conversationId:!0,createdAt:!0,updatedAt:!0,title:!0}).merge(e.object({conversationId:e.string().nullable().optional(),presetId:e.string().nullable().optional(),title:e.string().nullable().optional(),defaultPreset:e.boolean().optional(),order:e.number().optional(),endpoint:d.nullable()})),k=P.merge(e.object({endpoint:d.nullable()})),x=P.merge(e.object({endpoint:d.nullable()})),_=P.pick({model:!0,chatGptLabel:!0,promptPrefix:!0,temperature:!0,top_p:!0,presence_penalty:!0,frequency_penalty:!0,resendImages:!0,imageDetail:!0}).transform((function(e){var t,n,o,r,a,s,u,p,c;return i(i({},e),{model:null!==(t=e.model)&&void 0!==t?t:"gpt-3.5-turbo",chatGptLabel:null!==(n=e.chatGptLabel)&&void 0!==n?n:null,promptPrefix:null!==(o=e.promptPrefix)&&void 0!==o?o:null,temperature:null!==(r=e.temperature)&&void 0!==r?r:1,top_p:null!==(a=e.top_p)&&void 0!==a?a:1,presence_penalty:null!==(s=e.presence_penalty)&&void 0!==s?s:0,frequency_penalty:null!==(u=e.frequency_penalty)&&void 0!==u?u:0,resendImages:null!==(p=e.resendImages)&&void 0!==p&&p,imageDetail:null!==(c=e.imageDetail)&&void 0!==c?c:l.auto})})).catch((function(){return{model:"gpt-3.5-turbo",chatGptLabel:null,promptPrefix:null,temperature:1,top_p:1,presence_penalty:0,frequency_penalty:0,resendImages:!1,imageDetail:l.auto}})),C=P.pick({model:!0,modelLabel:!0,promptPrefix:!0,examples:!0,temperature:!0,maxOutputTokens:!0,topP:!0,topK:!0}).transform((function(e){var t,n,o,r,a,s,l,u,c,d,h=null===(n=null===(t=null==e?void 0:e.model)||void 0===t?void 0:t.toLowerCase())||void 0===n?void 0:n.includes("gemini-pro"),g=h?p.maxOutputTokens.maxGeminiPro:p.maxOutputTokens.max,f=h?p.maxOutputTokens.defaultGeminiPro:p.maxOutputTokens.default,m=null!==(o=e.maxOutputTokens)&&void 0!==o?o:f;return m=Math.min(m,g),i(i({},e),{model:null!==(r=e.model)&&void 0!==r?r:p.model.default,modelLabel:null!==(a=e.modelLabel)&&void 0!==a?a:null,promptPrefix:null!==(s=e.promptPrefix)&&void 0!==s?s:null,examples:null!==(l=e.examples)&&void 0!==l?l:[{input:{content:""},output:{content:""}}],temperature:null!==(u=e.temperature)&&void 0!==u?u:p.temperature.default,maxOutputTokens:m,topP:null!==(c=e.topP)&&void 0!==c?c:p.topP.default,topK:null!==(d=e.topK)&&void 0!==d?d:p.topK.default})})).catch((function(){return{model:p.model.default,modelLabel:null,promptPrefix:null,examples:[{input:{content:""},output:{content:""}}],temperature:p.temperature.default,maxOutputTokens:p.maxOutputTokens.default,topP:p.topP.default,topK:p.topK.default}})),E=P.pick({jailbreak:!0,systemMessage:!0,context:!0,toneStyle:!0,jailbreakConversationId:!0,conversationSignature:!0,clientId:!0,invocationId:!0}).transform((function(e){var t,n,o,r,a,s,l,u;return i(i({},e),{model:"",jailbreak:null!==(t=e.jailbreak)&&void 0!==t&&t,systemMessage:null!==(n=e.systemMessage)&&void 0!==n?n:null,context:null!==(o=e.context)&&void 0!==o?o:null,toneStyle:null!==(r=e.toneStyle)&&void 0!==r?r:"creative",jailbreakConversationId:null!==(a=e.jailbreakConversationId)&&void 0!==a?a:null,conversationSignature:null!==(s=e.conversationSignature)&&void 0!==s?s:null,clientId:null!==(l=e.clientId)&&void 0!==l?l:null,invocationId:null!==(u=e.invocationId)&&void 0!==u?u:1})})).catch((function(){return{model:"",jailbreak:!1,systemMessage:null,context:null,toneStyle:"creative",jailbreakConversationId:null,conversationSignature:null,clientId:null,invocationId:1}})),w=P.pick({model:!0,modelLabel:!0,promptPrefix:!0,temperature:!0,maxOutputTokens:!0,topP:!0,topK:!0}).transform((function(e){var t,n,o,r,a,s,l;return i(i({},e),{model:null!==(t=e.model)&&void 0!==t?t:"claude-1",modelLabel:null!==(n=e.modelLabel)&&void 0!==n?n:null,promptPrefix:null!==(o=e.promptPrefix)&&void 0!==o?o:null,temperature:null!==(r=e.temperature)&&void 0!==r?r:1,maxOutputTokens:null!==(a=e.maxOutputTokens)&&void 0!==a?a:4e3,topP:null!==(s=e.topP)&&void 0!==s?s:.7,topK:null!==(l=e.topK)&&void 0!==l?l:5})})).catch((function(){return{model:"claude-1",modelLabel:null,promptPrefix:null,temperature:1,maxOutputTokens:4e3,topP:.7,topK:5}})),A=P.pick({model:!0}).transform((function(e){var t;return i(i({},e),{model:null!==(t=e.model)&&void 0!==t?t:"text-davinci-002-render-sha"})})).catch((function(){return{model:"text-davinci-002-render-sha"}})),T=P.pick({model:!0,chatGptLabel:!0,promptPrefix:!0,temperature:!0,top_p:!0,presence_penalty:!0,frequency_penalty:!0,tools:!0,agentOptions:!0}).transform((function(e){var t,n,o,r,a,s,l,u,p;return i(i({},e),{model:null!==(t=e.model)&&void 0!==t?t:"gpt-3.5-turbo",chatGptLabel:null!==(n=e.chatGptLabel)&&void 0!==n?n:null,promptPrefix:null!==(o=e.promptPrefix)&&void 0!==o?o:null,temperature:null!==(r=e.temperature)&&void 0!==r?r:.8,top_p:null!==(a=e.top_p)&&void 0!==a?a:1,presence_penalty:null!==(s=e.presence_penalty)&&void 0!==s?s:0,frequency_penalty:null!==(l=e.frequency_penalty)&&void 0!==l?l:0,tools:null!==(u=e.tools)&&void 0!==u?u:[],agentOptions:null!==(p=e.agentOptions)&&void 0!==p?p:{agent:"functions",skipCompletion:!0,model:"gpt-3.5-turbo",temperature:0}})})).catch((function(){return{model:"gpt-3.5-turbo",chatGptLabel:null,promptPrefix:null,temperature:.8,top_p:1,presence_penalty:0,frequency_penalty:0,tools:[],agentOptions:{agent:"functions",skipCompletion:!0,model:"gpt-3.5-turbo",temperature:0}}}));function L(e){var t=i({},e);return Object.keys(t).forEach((function(e){void 0!==t[e]&&null!==t[e]&&""!==t[e]||delete t[e]})),t}var S,G,j,N,K,D,M=P.pick({model:!0,assistant_id:!0,thread_id:!0}).transform(L).catch((function(){return{}})),R=P.pick({model:!0,chatGptLabel:!0,promptPrefix:!0,temperature:!0,top_p:!0,presence_penalty:!0,frequency_penalty:!0,resendImages:!0,imageDetail:!0}).transform((function(e){var t=i({},e);return"gpt-3.5-turbo"===t.model&&delete t.model,1===t.temperature&&delete t.temperature,1===t.top_p&&delete t.top_p,0===t.presence_penalty&&delete t.presence_penalty,0===t.frequency_penalty&&delete t.frequency_penalty,!0!==t.resendImages&&delete t.resendImages,t.imageDetail===l.auto&&delete t.imageDetail,L(t)})).catch((function(){return{}})),q=P.pick({model:!0,modelLabel:!0,promptPrefix:!0,examples:!0,temperature:!0,maxOutputTokens:!0,topP:!0,topK:!0}).transform((function(e){var t=i({},e);return t.model===p.model.default&&delete t.model,t.temperature===p.temperature.default&&delete t.temperature,t.maxOutputTokens===p.maxOutputTokens.default&&delete t.maxOutputTokens,t.topP===p.topP.default&&delete t.topP,t.topK===p.topK.default&&delete t.topK,L(t)})).catch((function(){return{}})),B=P.pick({model:!0,modelLabel:!0,promptPrefix:!0,temperature:!0,maxOutputTokens:!0,topP:!0,topK:!0}).transform((function(e){var t=i({},e);return"claude-1"===t.model&&delete t.model,1===t.temperature&&delete t.temperature,4e3===t.maxOutputTokens&&delete t.maxOutputTokens,.7===t.topP&&delete t.topP,5===t.topK&&delete t.topK,L(t)})).catch((function(){return{}})),z=P.pick({model:!0}).transform((function(e){var t=i({},e);return"text-davinci-002-render-sha"===t.model&&delete t.model,L(t)})).catch((function(){return{}})),U=P.pick({model:!0,chatGptLabel:!0,promptPrefix:!0,temperature:!0,top_p:!0,presence_penalty:!0,frequency_penalty:!0,tools:!0,agentOptions:!0}).transform((function(e){var t,n=i({},e);return"gpt-3.5-turbo"===n.model&&delete n.model,null===n.chatGptLabel&&delete n.chatGptLabel,null===n.promptPrefix&&delete n.promptPrefix,.8===n.temperature&&delete n.temperature,1===n.top_p&&delete n.top_p,0===n.presence_penalty&&delete n.presence_penalty,0===n.frequency_penalty&&delete n.frequency_penalty,0===(null===(t=n.tools)||void 0===t?void 0:t.length)&&delete n.tools,n.agentOptions&&"functions"===n.agentOptions.agent&&!0===n.agentOptions.skipCompletion&&"gpt-3.5-turbo"===n.agentOptions.model&&0===n.agentOptions.temperature&&delete n.agentOptions,L(n)})).catch((function(){return{}}));!function(e){e.local="local",e.firebase="firebase",e.openai="openai",e.s3="s3"}(S||(S={}));var F,H=e.nativeEnum(S),V=e.object({name:e.string().refine((function(e){return!c.safeParse(e).success}),{message:"Value cannot be one of the default endpoint (EModelEndpoint) values: ".concat(Object.values(r).join(", "))}),apiKey:e.string(),baseURL:e.string(),models:e.object({default:e.array(e.string()).min(1),fetch:e.boolean().optional()}),titleConvo:e.boolean().optional(),titleMethod:e.union([e.literal("completion"),e.literal("functions")]).optional(),titleModel:e.string().optional(),summarize:e.boolean().optional(),summaryModel:e.string().optional(),forcePrompt:e.boolean().optional(),modelDisplayLabel:e.string().optional(),headers:e.record(e.any()).optional()}),W=e.object({version:e.string(),cache:e.boolean(),fileStrategy:H.optional(),registration:e.object({socialLogins:e.array(e.string()).optional(),allowedDomains:e.array(e.string()).optional()}).optional(),endpoints:e.object({custom:e.array(V.partial())}).strict()});!function(e){e.mistral="mistral",e.openrouter="openrouter"}(F||(F={}));var Y,J,Q,X,Z,$=[r.openAI,r.assistant,r.azureOpenAI,r.bingAI,r.chatGPTBrowser,r.gptPlugins,r.google,r.anthropic,r.custom],ee=((G={})[r.openAI]="OpenAI",G[r.assistant]="Assistants",G[r.azureOpenAI]="Azure OpenAI",G[r.bingAI]="Bing",G[r.chatGPTBrowser]="ChatGPT",G[r.gptPlugins]="Plugins",G[r.google]="Google",G[r.anthropic]="Anthropic",G[r.custom]="Custom",G),te=((j={})[r.google]=["gemini-pro","gemini-pro-vision","chat-bison","chat-bison-32k","codechat-bison","codechat-bison-32k","text-bison","text-bison-32k","text-unicorn","code-gecko","code-bison","code-bison-32k"],j[r.anthropic]=["claude-2.1","claude-2","claude-1.2","claude-1","claude-1-100k","claude-instant-1","claude-instant-1-100k"],j[r.openAI]=["gpt-3.5-turbo-0125","gpt-3.5-turbo-16k-0613","gpt-3.5-turbo-16k","gpt-4-turbo-preview","gpt-4-0125-preview","gpt-4-1106-preview","gpt-3.5-turbo","gpt-3.5-turbo-1106","gpt-4-vision-preview","gpt-4","gpt-3.5-turbo-instruct-0914","gpt-3.5-turbo-0613","gpt-3.5-turbo-0301","gpt-3.5-turbo-instruct","gpt-4-0613","text-davinci-003","gpt-4-0314"],j),ne=((N={})[r.openAI]="/api/ask/".concat(r.openAI),N[r.bingAI]="/api/ask/".concat(r.bingAI),N[r.google]="/api/ask/".concat(r.google),N[r.custom]="/api/ask/".concat(r.custom),N[r.anthropic]="/api/ask/".concat(r.anthropic),N[r.gptPlugins]="/api/ask/".concat(r.gptPlugins),N[r.azureOpenAI]="/api/ask/".concat(r.azureOpenAI),N[r.chatGPTBrowser]="/api/ask/".concat(r.chatGPTBrowser),N[r.assistant]="/api/assistants/chat",N),oe=new Set([r.gptPlugins,r.anthropic,r.google,r.openAI,r.azureOpenAI,r.custom]),re=((K={})[r.openAI]=!0,K[r.google]=!0,K[r.assistant]=!0,K[r.azureOpenAI]=!0,K[r.custom]=!0,K),ie=((D={})[r.openAI]=!0,D[r.azureOpenAI]=!0,D[r.gptPlugins]=!0,D[r.custom]=!0,D),ae=["gpt-4-vision","llava-13b","gemini-pro-vision"];!function(e){e.CONFIG_STORE="configStore",e.PLUGINS="plugins",e.GEN_TITLE="genTitle",e.MODELS_CONFIG="modelsConfig",e.ENDPOINT_CONFIG="endpointsConfig",e.TOKEN_CONFIG="tokenConfig",e.CUSTOM_CONFIG="customConfig",e.OVERRIDE_CONFIG="overrideConfig"}(Y||(Y={})),function(e){e.GOOGLE_SERVICE_KEY="GOOGLE_SERVICE_KEY",e.GOOGLE_API_KEY="GOOGLE_API_KEY"}(J||(J={})),function(e){e[e.LOW=85]="LOW",e[e.HIGH=170]="HIGH",e[e.ADDITIONAL=85]="ADDITIONAL"}(Q||(Q={})),function(e){e.GENERAL="general",e.BETA="beta",e.DATA="data",e.ACCOUNT="account"}(X||(X={}));var se=((Z={})[r.openAI]=_,Z[r.azureOpenAI]=_,Z[r.custom]=_,Z[r.google]=C,Z[r.bingAI]=E,Z[r.anthropic]=w,Z[r.chatGPTBrowser]=A,Z[r.gptPlugins]=T,Z[r.assistant]=M,Z);function le(e){for(var t,n=0,o=e;n<o.length;n++){var r=o[n];if(r){t=r;break}}return t}var ue,pe,ce,de=function(e){var t,n,o=e.endpoint,r=e.endpointType,i=e.conversation,a=e.possibleValues,s=se[o];if(!s&&!r)throw new Error("Unknown endpoint: ".concat(o));!s&&r&&(s=se[r]);var l=s.parse(i),u=null!=a?a:{},p=u.models,c=u.secondaryModels;return p&&l&&(l.model=null!==(t=le(p))&&void 0!==t?t:l.model),c&&l.agentOptions&&(l.agentOptions.model=null!==(n=le(c))&&void 0!==n?n:l.agentOptions.model),l},he=function(e){var t,n=e.model,o=e.endpoint,i=e.endpointType,a=e.modelDisplayLabel,s=e.chatGptLabel,l=e.modelLabel,u=e.jailbreak;return[r.openAI,r.azureOpenAI,r.gptPlugins,r.chatGPTBrowser].includes(o)?s||(n&&n.includes("gpt-3")?"GPT-3.5":n&&n.includes("gpt-4")?"GPT-4":n&&n.includes("mistral")?"Mistral":null!==(t=ee[o])&&void 0!==t?t:"ChatGPT"):o===r.bingAI?u?"Sydney":"BingAI":o===r.anthropic?null!=l?l:"Claude":o===r.google?l||(n&&n.includes("gemini")?"Gemini":n&&n.includes("code")?"Codey":"PaLM2"):o===r.custom||i===r.custom?l||(s||(n&&n.includes("mistral")?"Mistral":n&&n.includes("gpt-3")?"GPT-3.5":n&&n.includes("gpt-4")?"GPT-4":a||"AI")):""},ge={openAI:R,azureOpenAI:R,custom:R,assistant:M,google:q,bingAI:E,anthropic:B,chatGPTBrowser:z,gptPlugins:U},fe=function(e){var t,n=e.endpoint,o=e.endpointType,r=e.conversation,i=e.possibleValues;if(!n)throw new Error("undefined endpoint: ".concat(n));var a=ge[n];if(!a&&!o)throw new Error("Unknown endpoint: ".concat(n));!a&&o&&(a=ge[o]);var s=a.parse(r),l=(null!=i?i:{}).models;return l&&s&&(s.model=null!==(t=le(l))&&void 0!==t?t:s.model),s};function me(e){t.defaults.headers.common["Accept-Language"]=e}function ve(e){t.defaults.headers.common.Authorization="Bearer "+e}!function(e){e.code_interpreter="code_interpreter",e.retrieval="retrieval",e.function="function"}(ue||(ue={})),function(e){e.messages="messages",e.allConversations="allConversations",e.searchConversations="searchConversations",e.conversation="conversation",e.searchEnabled="searchEnabled",e.user="user",e.name="name",e.models="models",e.balance="balance",e.endpoints="endpoints",e.presets="presets",e.searchResults="searchResults",e.tokenCount="tokenCount",e.availablePlugins="availablePlugins",e.startupConfig="startupConfig",e.assistants="assistants",e.assistant="assistant",e.endpointsConfigOverride="endpointsConfigOverride",e.files="files"}(pe||(pe={})),function(e){e.imageUpload="imageUpload",e.fileDelete="fileDelete",e.updatePreset="updatePreset",e.deletePreset="deletePreset",e.logoutUser="logoutUser",e.avatarUpload="avatarUpload"}(ce||(ce={}));var be=function(e,t){return"/api/messages/".concat(e).concat(t?"/".concat(t):"")},ye="/api/keys",Ie=function(e){return"/api/convos?pageNumber=".concat(e)},Pe=function(e,t){return"/api/search?q=".concat(e,"&pageNumber=").concat(t)},Oe=function(e){return"/api/assistants".concat(e?"/".concat(e):"")},ke=function(){return"".concat("/api/files","/images")};function xe(e,n){return a(this,void 0,void 0,(function(){return s(this,(function(o){switch(o.label){case 0:return[4,t.post(e,JSON.stringify(n),{headers:{"Content-Type":"application/json"}})];case 1:return[2,o.sent().data]}}))}))}var _e=!1,Ce=[],Ee=function(e){return xe(function(e){return"/api/auth/refresh".concat(e?"?retry=true":"")}(e))},we=function(e,t){void 0===t&&(t=null),Ce.forEach((function(n){e?n.reject(e):n.resolve(t)})),Ce=[]};t.interceptors.response.use((function(e){return e}),(function(e){return a(void 0,void 0,void 0,(function(){var n,o,r,i,a;return s(this,(function(s){switch(s.label){case 0:if(n=e.config,401!==e.response.status||n._retry)return[3,13];if(n._retry=!0,!_e)return[3,5];s.label=1;case 1:return s.trys.push([1,4,,5]),[4,new Promise((function(e,t){Ce.push({resolve:e,reject:t})}))];case 2:return r=s.sent(),n.headers.Authorization="Bearer "+r,[4,t(n)];case 3:return[2,s.sent()];case 4:return o=s.sent(),[2,Promise.reject(o)];case 5:_e=!0,s.label=6;case 6:return s.trys.push([6,11,12,13]),[4,Ee(!!(null===(a=n.url)||void 0===a?void 0:a.includes("api/auth/refresh")))];case 7:return(r=s.sent().token)?(n.headers.Authorization="Bearer "+r,ve(r),window.dispatchEvent(new CustomEvent("tokenUpdated",{detail:r})),we(null,r),[4,t(n)]):[3,9];case 8:return[2,s.sent()];case 9:window.location.href="/login",s.label=10;case 10:return[3,13];case 11:return i=s.sent(),we(i,null),[2,Promise.reject(i)];case 12:return _e=!1,[7];case 13:return[2,Promise.reject(e)]}}))}))}));var Ae={get:function(e,n){return a(this,void 0,void 0,(function(){return s(this,(function(o){switch(o.label){case 0:return[4,t.get(e,i({},n))];case 1:return[2,o.sent().data]}}))}))},post:xe,postMultiPart:function(e,n,o){return a(this,void 0,void 0,(function(){return s(this,(function(r){switch(r.label){case 0:return[4,t.post(e,n,i(i({},o),{headers:{"Content-Type":"multipart/form-data"}}))];case 1:return[2,r.sent().data]}}))}))},put:function(e,n){return a(this,void 0,void 0,(function(){return s(this,(function(o){switch(o.label){case 0:return[4,t.put(e,JSON.stringify(n),{headers:{"Content-Type":"application/json"}})];case 1:return[2,o.sent().data]}}))}))},delete:function(e){return a(this,void 0,void 0,(function(){return s(this,(function(n){switch(n.label){case 0:return[4,t.delete(e)];case 1:return[2,n.sent().data]}}))}))},deleteWithOptions:function(e,n){return a(this,void 0,void 0,(function(){return s(this,(function(o){switch(o.label){case 0:return[4,t.delete(e,i({},n))];case 1:return[2,o.sent().data]}}))}))},patch:function(e,n){return a(this,void 0,void 0,(function(){return s(this,(function(o){switch(o.label){case 0:return[4,t.patch(e,JSON.stringify(n),{headers:{"Content-Type":"application/json"}})];case 1:return[2,o.sent().data]}}))}))},refreshToken:Ee};var Te=Object.freeze({__proto__:null,abortRequestWithMessage:function(e,t,n){return Ae.post(function(e){return"/api/ask/".concat(e,"/abort")}(e),{arg:{abortKey:t,message:n}})},clearAllConversations:function(){return Ae.post("/api/convos/clear",{arg:{}})},createAssistant:function(e){return Ae.post(Oe(),e)},createPreset:function(e){return Ae.post("/api/presets",e)},deleteAssistant:function(e){return Ae.delete(Oe(e))},deleteConversation:function(e){return Ae.post("/api/convos/clear",{arg:e})},deleteFiles:function(e){return a(void 0,void 0,void 0,(function(){return s(this,(function(t){return[2,Ae.deleteWithOptions("/api/files",{data:{files:e}})]}))}))},deletePreset:function(e){return Ae.post("/api/presets/delete",e)},genTitle:function(e){return Ae.post("/api/convos/gen_title",e)},getAIEndpoints:function(){return Ae.get("/api/endpoints")},getAssistantById:function(e){return Ae.get(Oe(e))},getAvailablePlugins:function(){return Ae.get("/api/plugins")},getConversationById:function(e){return Ae.get(function(e){return"/api/convos/".concat(e)}(e))},getConversations:function(e){return Ae.get(Ie(e))},getEndpointsConfigOverride:function(){return Ae.get("/api/endpoints/config/override")},getFiles:function(){return Ae.get("/api/files")},getLoginGoogle:function(){return Ae.get("/api/auth/google")},getMessagesByConvoId:function(e){return"new"===e?Promise.resolve([]):Ae.get(be(e))},getModels:function(){return a(void 0,void 0,void 0,(function(){return s(this,(function(e){return[2,Ae.get("/api/models")]}))}))},getPresets:function(){return Ae.get("/api/presets")},getSearchEnabled:function(){return Ae.get("/api/search/enable")},getStartupConfig:function(){return Ae.get("/api/config")},getUser:function(){return Ae.get("/api/user")},getUserBalance:function(){return Ae.get("/api/balance")},listAssistants:function(e){return Ae.get(Oe(),{params:e})},listConversations:function(e){var t=(null==e?void 0:e.pageNumber)||"1";return Ae.get(Ie(t))},listConversationsByQuery:function(e){var t=(null==e?void 0:e.pageNumber)||"1",n=(null==e?void 0:e.searchQuery)||"";return""!==n?Ae.get(Pe(n,t)):Ae.get(Ie(t))},login:function(e){return Ae.post("/api/auth/login",e)},logout:function(){return Ae.post("/api/auth/logout")},register:function(e){return Ae.post("/api/auth/register",e)},requestPasswordReset:function(e){return Ae.post("/api/auth/requestPasswordReset",e)},resetPassword:function(e){return Ae.post("/api/auth/resetPassword",e)},revokeAllUserKeys:function(){return Ae.delete("".concat(ye,"?all=true"))},revokeUserKey:function(e){return Ae.delete(function(e){return"".concat(ye,"/").concat(e)}(e))},searchConversations:function(e,t){return a(void 0,void 0,void 0,(function(){return s(this,(function(n){return[2,Ae.get(Pe(e,t))]}))}))},updateAssistant:function(e,t){return Ae.patch(Oe(e),t)},updateConversation:function(e){return Ae.post("/api/convos/update",{arg:e})},updateMessage:function(e){var t=e.conversationId,n=e.messageId,o=e.text;if(!t)throw new Error("conversationId is required");return Ae.put(be(t,n),{text:o})},updatePreset:function(e){return Ae.post("/api/presets",e)},updateTokenCount:function(e){return Ae.post("/api/tokenizer",{arg:e})},updateUserKey:function(e){if(!e.value)throw new Error("value is required");return Ae.put(ye,e)},updateUserPlugins:function(e){return Ae.post("/api/user/plugins",e)},uploadAvatar:function(e){return Ae.postMultiPart("".concat(ke(),"/avatar"),e)},uploadImage:function(e){return Ae.postMultiPart(ke(),e)},userKeyQuery:function(e){return Ae.get(function(e){return"".concat(ye,"?name=").concat(e)}(e))}}),Le=function(e,t){if(!(this instanceof Le))return new Le(e,t);this.INITIALIZING=-1,this.CONNECTING=0,this.OPEN=1,this.CLOSED=2,this.url=e,t=t||{},this.headers=t.headers||{},this.payload=void 0!==t.payload?t.payload:"",this.method=t.method||this.payload&&"POST"||"GET",this.withCredentials=!!t.withCredentials,this.FIELD_SEPARATOR=":",this.listeners={},this.xhr=null,this.readyState=this.INITIALIZING,this.progress=0,this.chunk="",this.addEventListener=function(e,t){void 0===this.listeners[e]&&(this.listeners[e]=[]),-1===this.listeners[e].indexOf(t)&&this.listeners[e].push(t)},this.removeEventListener=function(e,t){if(void 0!==this.listeners[e]){var n=[];this.listeners[e].forEach((function(e){e!==t&&n.push(e)})),0===n.length?delete this.listeners[e]:this.listeners[e]=n}},this.dispatchEvent=function(e){if(!e)return!0;e.source=this;var t="on"+e.type;return(!this.hasOwnProperty(t)||(this[t].call(this,e),!e.defaultPrevented))&&(!this.listeners[e.type]||this.listeners[e.type].every((function(t){return t(e),!e.defaultPrevented})))},this._setReadyState=function(e){var t=new CustomEvent("readystatechange");t.readyState=e,this.readyState=e,this.dispatchEvent(t)},this._onStreamFailure=function(e){var t=new CustomEvent("error");t.data=e.currentTarget.response,this.dispatchEvent(t),this.close()},this._onStreamAbort=function(e){this.dispatchEvent(new CustomEvent("abort")),this.close()},this._onStreamProgress=async function(e){if(this.xhr){if(401!==this.xhr.status||this._retry){if(200!==this.xhr.status)return void this._onStreamFailure(e)}else{this._retry=!0;try{const e=await Ae.refreshToken();this.headers={"Content-Type":"application/json",Authorization:`Bearer ${e.token}`},ve(e.token),window.dispatchEvent(new CustomEvent("tokenUpdated",{detail:e.token})),this.stream()}catch(t){return void this._onStreamFailure(e)}}this.readyState==this.CONNECTING&&(this.dispatchEvent(new CustomEvent("open")),this._setReadyState(this.OPEN));var t=this.xhr.responseText.substring(this.progress);this.progress+=t.length,t.split(/(\r\n|\r|\n){2}/g).forEach(function(e){0===e.trim().length?(this.dispatchEvent(this._parseEventChunk(this.chunk.trim())),this.chunk=""):this.chunk+=e}.bind(this))}},this._onStreamLoaded=function(e){this._onStreamProgress(e),this.dispatchEvent(this._parseEventChunk(this.chunk)),this.chunk=""},this._parseEventChunk=function(e){if(!e||0===e.length)return null;var t={id:null,retry:null,data:"",event:"message"};e.split(/\n|\r\n|\r/).forEach(function(e){var n=(e=e.trimRight()).indexOf(this.FIELD_SEPARATOR);if(!(n<=0)){var o=e.substring(0,n);if(o in t){var r=e.substring(n+1).trimLeft();"data"===o?t[o]+=r:t[o]=r}}}.bind(this));var n=new CustomEvent(t.event);return n.data=t.data,n.id=t.id,n},this._checkStreamClosed=function(){this.xhr&&this.xhr.readyState===XMLHttpRequest.DONE&&this._setReadyState(this.CLOSED)},this.stream=function(){for(var e in this._setReadyState(this.CONNECTING),this.xhr=new XMLHttpRequest,this.xhr.addEventListener("progress",this._onStreamProgress.bind(this)),this.xhr.addEventListener("load",this._onStreamLoaded.bind(this)),this.xhr.addEventListener("readystatechange",this._checkStreamClosed.bind(this)),this.xhr.addEventListener("error",this._onStreamFailure.bind(this)),this.xhr.addEventListener("abort",this._onStreamAbort.bind(this)),this.xhr.open(this.method,this.url),this.headers)this.xhr.setRequestHeader(e,this.headers[e]);this.xhr.withCredentials=this.withCredentials,this.xhr.send(this.payload)},this.close=function(){this.readyState!==this.CLOSED&&(this.xhr.abort(),this.xhr=null,this._setReadyState(this.CLOSED))}};function Se(e){var t=e.conversation,n=e.message,o=e.messages,a=e.endpointOption,s=e.isEdited,l=e.isContinued,u=k.parse(t).conversationId,p=a,c=p.endpoint,d=p.endpointType,h=ne[null!=d?d:c];s&&c===r.assistant?h+="/modify":s&&(h=h.replace("/ask/","/edit/"));var g=i(i(i({},n),a),{isContinued:!(!s||!l),conversationId:u});return c===r.assistant&&(g.messages=o),{server:h,payload:g}}export{J as AuthKeys,Y as CacheKeys,r as EModelEndpoint,ne as EndpointURLs,S as FileSources,l as ImageDetail,Q as ImageDetailCost,F as KnownEndpoints,ce as MutationKeys,pe as QueryKeys,Le as SSE,X as SettingsTabValues,ue as Tools,ee as alternateName,w as anthropicSchema,M as assistantSchema,E as bingAISchema,A as chatGPTBrowserSchema,B as compactAnthropicSchema,z as compactChatGPTSchema,q as compactGoogleSchema,R as compactOpenAISchema,U as compactPluginsSchema,W as configSchema,Se as createPayload,Te as dataService,$ as defaultEndpoints,te as defaultModels,f as eImageDetailSchema,c as eModelEndpointSchema,V as endpointSchema,u as endpointSettings,d as extendedModelEndpointSchema,H as fileSourceSchema,le as getFirstDefinedValue,he as getResponseSender,C as googleSchema,T as gptPluginsSchema,h as imageDetailNumeric,g as imageDetailValue,oe as modularEndpoints,_ as openAISchema,fe as parseCompactConvo,de as parseConvo,L as removeNullishValues,Ae as request,me as setAcceptLanguageHeader,ve as setTokenHeader,ie as supportsBalanceCheck,re as supportsFiles,y as tAgentOptionsSchema,P as tConversationSchema,k as tConvoUpdateSchema,b as tExampleSchema,I as tMessageSchema,m as tPluginAuthConfigSchema,v as tPluginSchema,O as tPresetSchema,x as tPresetUpdateSchema,ae as visionModels};
//# sourceMappingURL=index.es.js.map
