import{useQueryClient as n,useMutation as e,useQuery as t,useInfiniteQuery as r}from"@tanstack/react-query";import o from"axios";var u=function(){return u=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++)for(var o in e=arguments[t])Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o]);return n},u.apply(this,arguments)};function i(n,e,t,r){return new(t||(t=Promise))((function(o,u){function i(n){try{a(r.next(n))}catch(n){u(n)}}function c(n){try{a(r.throw(n))}catch(n){u(n)}}function a(n){var e;n.done?o(n.value):(e=n.value,e instanceof t?e:new t((function(n){n(e)}))).then(i,c)}a((r=r.apply(n,e||[])).next())}))}function c(n,e){var t,r,o,u,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return u={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u;function c(c){return function(a){return function(c){if(t)throw new TypeError("Generator is already executing.");for(;u&&(u=0,c[0]&&(i=0)),i;)try{if(t=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,r=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){i=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){i.label=c[1];break}if(6===c[0]&&i.label<o[1]){i.label=o[1],o=c;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(c);break}o[2]&&i.ops.pop(),i.trys.pop();continue}c=e.call(n,i)}catch(n){c=[6,n],r=0}finally{t=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,a])}}}"function"==typeof SuppressedError&&SuppressedError;var a=function(n,e){return"/api/messages/".concat(n).concat(e?"/".concat(e):"")},s="/api/keys",f=function(n,e){return"/api/search?q=".concat(n,"&pageNumber=").concat(e)},l=function(n){return"/api/assistants".concat(n?"/".concat(n):"")};function d(n,e){return i(this,void 0,void 0,(function(){return c(this,(function(t){switch(t.label){case 0:return[4,o.post(n,JSON.stringify(e),{headers:{"Content-Type":"application/json"}})];case 1:return[2,t.sent().data]}}))}))}var h=!1,p=[],v=function(n){return d(function(n){return"/api/auth/refresh".concat(n?"?retry=true":"")}(n))},g=function(n,e){void 0===e&&(e=null),p.forEach((function(t){n?t.reject(n):t.resolve(e)})),p=[]};o.interceptors.response.use((function(n){return n}),(function(n){return i(void 0,void 0,void 0,(function(){var e,t,r,u,i;return c(this,(function(c){switch(c.label){case 0:if(e=n.config,401!==n.response.status||e._retry)return[3,13];if(e._retry=!0,!h)return[3,5];c.label=1;case 1:return c.trys.push([1,4,,5]),[4,new Promise((function(n,e){p.push({resolve:n,reject:e})}))];case 2:return r=c.sent(),e.headers.Authorization="Bearer "+r,[4,o(e)];case 3:return[2,c.sent()];case 4:return t=c.sent(),[2,Promise.reject(t)];case 5:h=!0,c.label=6;case 6:return c.trys.push([6,11,12,13]),[4,v(!!(null===(i=e.url)||void 0===i?void 0:i.includes("api/auth/refresh")))];case 7:return(r=c.sent().token)?(e.headers.Authorization="Bearer "+r,function(n){o.defaults.headers.common.Authorization="Bearer "+n}(r),window.dispatchEvent(new CustomEvent("tokenUpdated",{detail:r})),g(null,r),[4,o(e)]):[3,9];case 8:return[2,c.sent()];case 9:window.location.href="/login",c.label=10;case 10:return[3,13];case 11:return u=c.sent(),g(u,null),[2,Promise.reject(u)];case 12:return h=!1,[7];case 13:return[2,Promise.reject(n)]}}))}))}));var m={get:function(n,e){return i(this,void 0,void 0,(function(){return c(this,(function(t){switch(t.label){case 0:return[4,o.get(n,u({},e))];case 1:return[2,t.sent().data]}}))}))},post:d,postMultiPart:function(n,e,t){return i(this,void 0,void 0,(function(){return c(this,(function(r){switch(r.label){case 0:return[4,o.post(n,e,u(u({},t),{headers:{"Content-Type":"multipart/form-data"}}))];case 1:return[2,r.sent().data]}}))}))},put:function(n,e){return i(this,void 0,void 0,(function(){return c(this,(function(t){switch(t.label){case 0:return[4,o.put(n,JSON.stringify(e),{headers:{"Content-Type":"application/json"}})];case 1:return[2,t.sent().data]}}))}))},delete:function(n){return i(this,void 0,void 0,(function(){return c(this,(function(e){switch(e.label){case 0:return[4,o.delete(n)];case 1:return[2,e.sent().data]}}))}))},deleteWithOptions:function(n,e){return i(this,void 0,void 0,(function(){return c(this,(function(t){switch(t.label){case 0:return[4,o.delete(n,u({},e))];case 1:return[2,t.sent().data]}}))}))},patch:function(n,e){return i(this,void 0,void 0,(function(){return c(this,(function(t){switch(t.label){case 0:return[4,o.patch(n,JSON.stringify(e),{headers:{"Content-Type":"application/json"}})];case 1:return[2,t.sent().data]}}))}))},refreshToken:v};function O(n){return m.delete(function(n){return"".concat(s,"/").concat(n)}(n))}function b(){return m.delete("".concat(s,"?all=true"))}function w(n){return m.get(function(n){return"/api/convos/".concat(n)}(n))}function y(n){if(!n.value)throw new Error("value is required");return m.put(s,n)}var S,P,C=function(n){return m.get(function(n){return"".concat(s,"?name=").concat(n)}(n))},M=function(n){return m.get(l(),{params:n})};!function(n){n.messages="messages",n.allConversations="allConversations",n.searchConversations="searchConversations",n.conversation="conversation",n.searchEnabled="searchEnabled",n.user="user",n.name="name",n.models="models",n.balance="balance",n.endpoints="endpoints",n.presets="presets",n.searchResults="searchResults",n.tokenCount="tokenCount",n.availablePlugins="availablePlugins",n.startupConfig="startupConfig",n.assistants="assistants",n.assistant="assistant",n.endpointsConfigOverride="endpointsConfigOverride",n.files="files"}(S||(S={})),function(n){n.imageUpload="imageUpload",n.fileDelete="fileDelete",n.updatePreset="updatePreset",n.deletePreset="deletePreset",n.logoutUser="logoutUser",n.avatarUpload="avatarUpload"}(P||(P={}));var Q=function(){var t=n();return e((function(n){return function(n,e,t){return m.post(function(n){return"/api/ask/".concat(n,"/abort")}(n),{arg:{abortKey:e,message:t}})}(n.endpoint,n.abortKey,n.message)}),{onSuccess:function(){t.invalidateQueries([S.balance])}})},R=function(n){return t([S.user],(function(){return m.get("/api/user")}),u({refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,retry:!1},n))},k=function(n,e){return t([S.messages,n],(function(){return"new"===(e=n)?Promise.resolve([]):m.get(a(e));var e}),u({refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1},e))},W=function(n){return t([S.balance],(function(){return m.get("/api/balance")}),u({refetchOnWindowFocus:!0,refetchOnReconnect:!0,refetchOnMount:!0},n))},F=function(n,e){return t([S.conversation,n],(function(){return w(n)}),u({refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1},e))},x=function(t){var r=n();return e((function(){return w(t)}),{onSuccess:function(){r.invalidateQueries([S.conversation,t])}})},E=function(t){var r=n();return e((function(n){return function(n){var e=n.conversationId,t=n.messageId,r=n.text;if(!e)throw new Error("conversationId is required");return m.put(a(e,t),{text:r})}(n)}),{onSuccess:function(){r.invalidateQueries([S.messages,t])}})},T=function(){var t=n();return e((function(n){return y(n)}),{onSuccess:function(){t.invalidateQueries([S.name])}})},j=function(){var t=n();return e((function(){return m.post("/api/convos/clear",{arg:{}})}),{onSuccess:function(){t.invalidateQueries([S.allConversations])}})},I=function(t){var r=n();return e((function(){return O(t)}),{onSuccess:function(){r.invalidateQueries([S.name])}})},U=function(){var t=n();return e((function(){return b()}),{onSuccess:function(){t.invalidateQueries([S.name])}})},_=function(n,e){return t([S.allConversations],(function(){return function(n){return m.get(function(n){return"/api/convos?pageNumber=".concat(n)}(n))}(n)}),u({refetchOnReconnect:!1,refetchOnMount:!1,retry:1},e))},N=function(n){return t([S.searchEnabled],(function(){return m.get("/api/search/enable")}),u({refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1},n))},q=function(n){return t([S.endpoints],(function(){return m.get("/api/endpoints")}),u({staleTime:1/0,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1},n))},A=function(n){return t([S.models],(function(){return i(void 0,void 0,void 0,(function(){return c(this,(function(n){return[2,m.get("/api/models")]}))}))}),u({staleTime:1/0,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1},n))},z=function(){var t=n();return e((function(n){return function(n){return m.post("/api/presets",n)}(n)}),{onSuccess:function(){t.invalidateQueries([S.presets])}})},B=function(){var t=n();return e((function(n){return e=n,m.post("/api/presets/delete",e);var e}),{onSuccess:function(){t.invalidateQueries([S.presets])}})},D=function(n,e,r){return t([S.searchResults,e,n],(function(){return function(n,e){return i(void 0,void 0,void 0,(function(){return c(this,(function(t){return[2,m.get(f(n,e))]}))}))}(n,e)}),u({refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1},r))},J=function(){var t=n();return e((function(n){return function(n){return m.post("/api/tokenizer",{arg:n})}(n.text)}),{onSuccess:function(){t.invalidateQueries([S.tokenCount])}})},K=function(){var t=n();return e((function(n){return function(n){return m.post("/api/auth/login",n)}(n)}),{onMutate:function(){t.removeQueries(),localStorage.removeItem("lastConversationSetup"),localStorage.removeItem("lastSelectedModel"),localStorage.removeItem("lastSelectedTools"),localStorage.removeItem("filesToDelete"),localStorage.removeItem("lastAssistant")}})},G=function(){var t=n();return e((function(n){return function(n){return m.post("/api/auth/register",n)}(n)}),{onSuccess:function(){t.invalidateQueries([S.user])}})},L=function(){var t=n();return e((function(){return m.refreshToken()}),{onMutate:function(){t.removeQueries()}})},H=function(n,e){return t([S.name,n],(function(){return n?C(n):Promise.resolve({expiresAt:""})}),u({refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,retry:!1},e))},V=function(){return e((function(n){return function(n){return m.post("/api/auth/requestPasswordReset",n)}(n)}))},X=function(){return e((function(n){return function(n){return m.post("/api/auth/resetPassword",n)}(n)}))},Y=function(){return t([S.availablePlugins],(function(){return m.get("/api/plugins")}),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1})},Z=function(){var t=n();return e((function(n){return function(n){return m.post("/api/user/plugins",n)}(n)}),{onSuccess:function(){t.invalidateQueries([S.user])}})},$=function(){return t([S.startupConfig],(function(){return m.get("/api/config")}),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1})},nn=function(n,e){return t([S.assistants,n],(function(){return M(n)}),u({refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,retry:!1},e))},en=function(n,e){return r(["assistantsList",n],(function(e){var t=e.pageParam,r=void 0===t?"":t;return M(u(u({},n),{after:r}))}),u({getNextPageParam:function(n){if(n.has_more)return n.last_id}},e))},tn=function(){var t=n();return e((function(n){return e=n,m.post(l(),e);var e}),{onSuccess:function(){t.invalidateQueries([S.assistants])}})},rn=function(n,e){return t([S.assistant,n],(function(){return function(n){return m.get(l(n))}(n)}),u({enabled:!!n,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,retry:!1},e))},on=function(){var t=n();return e((function(n){return function(n,e){return m.patch(l(n),e)}(n.assistant_id,n.data)}),{onSuccess:function(n,e){var r=e.assistant_id;t.invalidateQueries([S.assistant,r]),t.invalidateQueries([S.assistants])}})},un=function(){var t=n();return e((function(n){return function(n){return m.delete(l(n))}(n.assistant_id)}),{onSuccess:function(){t.invalidateQueries([S.assistants])}})};export{Q as useAbortRequestWithMessage,Y as useAvailablePluginsQuery,j as useClearConversationsMutation,tn as useCreateAssistantMutation,z as useCreatePresetMutation,un as useDeleteAssistantMutation,B as useDeletePresetMutation,rn as useGetAssistantByIdQuery,x as useGetConversationByIdMutation,F as useGetConversationByIdQuery,_ as useGetConversationsQuery,q as useGetEndpointsQuery,k as useGetMessagesByConvoId,A as useGetModelsQuery,N as useGetSearchEnabledQuery,$ as useGetStartupConfig,W as useGetUserBalance,R as useGetUserQuery,en as useListAssistantsInfiniteQuery,nn as useListAssistantsQuery,K as useLoginUserMutation,L as useRefreshTokenMutation,G as useRegisterUserMutation,V as useRequestPasswordResetMutation,X as useResetPasswordMutation,U as useRevokeAllUserKeysMutation,I as useRevokeUserKeyMutation,D as useSearchQuery,on as useUpdateAssistantMutation,E as useUpdateMessageMutation,J as useUpdateTokenCountMutation,T as useUpdateUserKeysMutation,Z as useUpdateUserPluginsMutation,H as useUserKeyQuery};
//# sourceMappingURL=index.es.js.map
